{
  "name": "{{COMPANY_NAME}} - Carpenter Smart Email Automation",
  "nodes": [
    {
      "parameters": {
        "functionCode": "// Carpentry Business Intelligence Config Cache Manager\nconst clientId = $env.CLIENT_ID;\nconst configData = $input.first().json;\nconst cacheKey = `config:${clientId}:${configData.version}`;\n\nconst enhancedConfig = {\n  ...configData,\n  carpentryIntelligence: {\n    hasEmergencyService: configData.client.phones?.length > 1,\n    serviceTypes: configData.services || ['framing', 'finish_carpentry', 'cabinet_installation', 'deck_building', 'custom_millwork'],\n    workingHours: configData.client.hours || {},\n    priceRanges: configData.pricing || {},\n    serviceArea: configData.client.service_area || 'Local area',\n    managerNames: (configData.people.managers || []).map(m => m.name),\n    supplierDomains: (configData.suppliers || []).flatMap(s => s.domains || []),\n    specializations: ['residential', 'commercial', 'custom_work', 'restoration'],\n    emergencyKeywords: ['structural damage', 'emergency repair', 'safety hazard', 'urgent'],\n    projectTypes: {\n      framing: ['new_construction', 'additions', 'structural_repairs', 'load_bearing'],\n      finish: ['trim_work', 'crown_molding', 'baseboards', 'door_installation'],\n      custom: ['built_in_cabinets', 'custom_shelving', 'entertainment_centers', 'bookcases'],\n      outdoor: ['decks', 'pergolas', 'gazebos', 'outdoor_structures']\n    },\n    commonServices: {\n      residential: ['kitchen_cabinets', 'bathroom_vanities', 'closet_systems', 'trim_installation'],\n      commercial: ['office_buildouts', 'retail_fixtures', 'restaurant_millwork', 'storefront_work'],\n      repair: ['door_repairs', 'window_repairs', 'deck_repairs', 'structural_fixes']\n    },\n    seasonalConsiderations: {\n      spring: ['deck_construction', 'outdoor_projects', 'home_additions'],\n      summer: ['exterior_work', 'siding_repairs', 'outdoor_structures'],\n      fall: ['interior_projects', 'winterization', 'storm_damage_repairs'],\n      winter: ['indoor_renovations', 'custom_millwork', 'cabinet_projects']\n    }\n  }\n};\n\n$setStaticData(cacheKey, enhancedConfig);\nreturn [{ json: { ...enhancedConfig, cached: false, cacheKey: cacheKey } }];"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,
      "position": [-5400, 3200],
      "id": "carpentry-config-cache",
      "name": "Carpentry Config Cache"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Subject: {{ $('Gmail Trigger').item.json.subject }}\\nFrom: {{ $('Gmail Trigger').item.json.from }}\\nEmail Body: {{ $('Gmail Trigger').item.json.body }}",
        "options": {
          "systemMessage": "=You are an expert carpentry contractor email classifier for {{ $json.client.name || 'a carpentry service company' }}.\\n\\nüè¢ CARPENTRY BUSINESS CONTEXT:\\n- Company: {{ $json.client.name || 'Carpentry Service Company' }}\\n- Services: {{ $json.carpentryIntelligence.serviceTypes.join(', ') }}\\n- Service Area: {{ $json.carpentryIntelligence.serviceArea }}\\n\\nüéØ CARPENTRY CLASSIFICATION RULES:\\n\\n**URGENT** (Immediate attention required):\\n- Structural damage or safety hazards\\n- Emergency repairs affecting building integrity\\n- Storm damage to wooden structures\\n- Safety issues with decks or stairs\\n\\n**SALES** (Revenue opportunities):\\n- Custom cabinet projects\\n- Deck and outdoor structure construction\\n- Home additions and renovations\\n- Commercial buildouts and millwork\\n- Kitchen and bathroom remodeling\\n\\n**SUPPORT** (Customer service):\\n- Trim and finish work\\n- Door and window installations\\n- Repair and maintenance services\\n- Custom shelving and built-ins\\n\\n**SUPPLIERS** (Vendor communications):\\n- Lumber and material deliveries\\n- Hardware and fastener orders\\n- Tool and equipment suppliers\\n\\nüî® CARPENTRY SPECIALIZATIONS:\\n- **Framing:** New construction, additions, structural work\\n- **Finish:** Trim, molding, doors, windows\\n- **Custom:** Built-ins, cabinets, millwork\\n- **Outdoor:** Decks, pergolas, outdoor structures\\n\\nüåü SEASONAL CONSIDERATIONS:\\n- **Spring/Summer:** Outdoor projects, deck construction\\n- **Fall/Winter:** Indoor renovations, custom millwork\\n\\nü§ñ CLASSIFICATION OUTPUT:\\n{\\n  \\\"primary_category\\\": \\\"category_name\\\",\\n  \\\"confidence\\\": 0.95,\\n  \\\"reasoning\\\": \\\"detailed explanation\\\",\\n  \\\"urgency_level\\\": \\\"low|medium|high|critical\\\",\\n  \\\"requires_draft\\\": true/false,\\n  \\\"carpentry_context\\\": {\\n    \\\"is_emergency\\\": true/false,\\n    \\\"project_type\\\": \\\"framing|finish|custom|outdoor|repair\\\",\\n    \\\"specialization\\\": \\\"residential|commercial|custom_work|restoration\\\"\\n  }\\n}"
        }
      },
      "id": "carpentry-ai-classifier",
      "name": "Carpentry AI Classifier",
      "type": "@n8n/n8n-nodes-langchain.chatOpenAi",
      "position": [-5100, 3200],
      "typeVersion": 1.3
    }
  ],
  "versionId": "6.0.0",
  "meta": {
    "templateVersion": "6.0.0",
    "industry": "Carpentry",
    "description": "Carpentry and millwork email automation with project-specific intelligence",
    "businessIntelligence": true
  }
}
