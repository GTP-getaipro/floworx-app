{
  "name": "{{COMPANY_NAME}} - Pipelayer Smart Email Automation",
  "nodes": [
    {
      "parameters": {
        "functionCode": "// Pipelaying Business Intelligence Config Cache Manager\nconst clientId = $env.CLIENT_ID;\nconst configData = $input.first().json;\nconst cacheKey = `config:${clientId}:${configData.version}`;\n\nconst enhancedConfig = {\n  ...configData,\n  pipelayingIntelligence: {\n    hasEmergencyService: configData.client.phones?.length > 1,\n    serviceTypes: configData.services || ['sewer_line_installation', 'water_line_installation', 'storm_drain', 'pipe_repair', 'excavation'],\n    workingHours: configData.client.hours || {},\n    priceRanges: configData.pricing || {},\n    serviceArea: configData.client.service_area || 'Local area',\n    managerNames: (configData.people.managers || []).map(m => m.name),\n    supplierDomains: (configData.suppliers || []).flatMap(s => s.domains || []),\n    specializations: ['municipal', 'residential', 'commercial', 'industrial'],\n    emergencyKeywords: ['pipe burst', 'sewer backup', 'water main break', 'emergency', 'urgent'],\n    pipeTypes: {\n      water: ['pvc_water_lines', 'copper_service', 'hdpe_mains', 'ductile_iron'],\n      sewer: ['pvc_sewer', 'clay_pipe', 'cast_iron', 'concrete_pipe'],\n      storm: ['corrugated_pipe', 'concrete_storm', 'hdpe_storm', 'catch_basins'],\n      gas: ['polyethylene_gas', 'steel_gas_mains', 'service_lines']\n    },\n    projectTypes: {\n      municipal: ['water_mains', 'sewer_mains', 'storm_systems', 'infrastructure'],\n      residential: ['service_connections', 'sewer_laterals', 'water_services'],\n      commercial: ['site_utilities', 'parking_lot_drainage', 'building_connections'],\n      industrial: ['process_piping', 'large_diameter', 'specialized_systems']\n    },\n    excavationMethods: {\n      open_cut: ['traditional_trenching', 'wide_excavation', 'utility_corridors'],\n      trenchless: ['horizontal_boring', 'pipe_bursting', 'slip_lining'],\n      specialized: ['rock_excavation', 'deep_utilities', 'confined_space']\n    },\n    safetyProtocols: {\n      excavation: ['cave_in_protection', 'shoring_systems', 'slope_stability'],\n      utilities: ['utility_locating', 'one_call_systems', 'damage_prevention'],\n      confined_space: ['atmospheric_testing', 'ventilation', 'rescue_procedures']\n    },\n    seasonalConsiderations: {\n      spring: ['frost_thaw_repairs', 'construction_season_start'],\n      summer: ['major_construction', 'municipal_projects'],\n      fall: ['winterization', 'emergency_repairs'],\n      winter: ['freeze_protection', 'emergency_only']\n    }\n  }\n};\n\n$setStaticData(cacheKey, enhancedConfig);\nreturn [{ json: { ...enhancedConfig, cached: false, cacheKey: cacheKey } }];"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,
      "position": [-5400, 3200],
      "id": "pipelaying-config-cache",
      "name": "Pipelaying Config Cache"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Subject: {{ $('Gmail Trigger').item.json.subject }}\\nFrom: {{ $('Gmail Trigger').item.json.from }}\\nEmail Body: {{ $('Gmail Trigger').item.json.body }}",
        "options": {
          "systemMessage": "=You are an expert pipelaying contractor email classifier for {{ $json.client.name || 'a pipelaying service company' }}.\\n\\nüè¢ PIPELAYING BUSINESS CONTEXT:\\n- Company: {{ $json.client.name || 'Pipelaying Service Company' }}\\n- Services: {{ $json.pipelayingIntelligence.serviceTypes.join(', ') }}\\n- Service Area: {{ $json.pipelayingIntelligence.serviceArea }}\\n- Specializations: {{ $json.pipelayingIntelligence.specializations.join(', ') }}\\n\\nüéØ PIPELAYING CLASSIFICATION RULES:\\n\\n**URGENT** (Immediate attention required):\\n- Water main breaks or pipe bursts\\n- Sewer line backups or overflows\\n- Emergency utility repairs\\n- Safety hazards from exposed utilities\\n\\n**SALES** (Revenue opportunities):\\n- New utility installation projects\\n- Municipal infrastructure contracts\\n- Commercial site development\\n- Residential service connections\\n- Trenchless pipe replacement\\n\\n**SUPPORT** (Customer service):\\n- Pipe repair and maintenance\\n- Utility locating services\\n- Excavation and backfill\\n- System inspections\\n\\n**SUPPLIERS** (Vendor communications):\\n- Pipe and fitting suppliers\\n- Excavation equipment suppliers\\n- Safety equipment providers\\n\\nüö∞ PIPE SPECIALIZATIONS:\\n- **Water:** PVC, copper, HDPE, ductile iron\\n- **Sewer:** PVC, clay, cast iron, concrete\\n- **Storm:** Corrugated, concrete, HDPE, catch basins\\n- **Gas:** Polyethylene, steel mains, service lines\\n\\nüèóÔ∏è PROJECT TYPES:\\n- **Municipal:** Water mains, sewer mains, storm systems\\n- **Residential:** Service connections, sewer laterals\\n- **Commercial:** Site utilities, drainage systems\\n- **Industrial:** Process piping, specialized systems\\n\\n‚õèÔ∏è EXCAVATION METHODS:\\n- **Open Cut:** Traditional trenching, wide excavation\\n- **Trenchless:** Horizontal boring, pipe bursting\\n- **Specialized:** Rock excavation, deep utilities\\n\\n‚ö†Ô∏è SAFETY PROTOCOLS (CRITICAL):\\n- Cave-in protection and shoring systems\\n- Utility locating and damage prevention\\n- Confined space safety procedures\\n- Atmospheric testing and ventilation\\n\\nüå°Ô∏è SEASONAL CONSIDERATIONS:\\n- **Spring:** Frost-thaw repairs, construction season\\n- **Summer:** Major construction, municipal projects\\n- **Fall/Winter:** Emergency repairs, freeze protection\\n\\nü§ñ CLASSIFICATION OUTPUT:\\n{\\n  \\\"primary_category\\\": \\\"category_name\\\",\\n  \\\"confidence\\\": 0.95,\\n  \\\"reasoning\\\": \\\"detailed explanation\\\",\\n  \\\"urgency_level\\\": \\\"low|medium|high|critical\\\",\\n  \\\"requires_draft\\\": true/false,\\n  \\\"pipelaying_context\\\": {\\n    \\\"is_emergency\\\": true/false,\\n    \\\"pipe_type\\\": \\\"water|sewer|storm|gas\\\",\\n    \\\"project_type\\\": \\\"municipal|residential|commercial|industrial\\\",\\n    \\\"excavation_method\\\": \\\"open_cut|trenchless|specialized\\\"\\n  }\\n}"
        }
      },
      "id": "pipelaying-ai-classifier",
      "name": "Pipelaying AI Classifier",
      "type": "@n8n/n8n-nodes-langchain.chatOpenAi",
      "position": [-5100, 3200],
      "typeVersion": 1.3
    }
  ],
  "versionId": "12.0.0",
  "meta": {
    "templateVersion": "12.0.0",
    "industry": "Pipelaying",
    "description": "Pipelaying contractor email automation with utility and excavation intelligence",
    "businessIntelligence": true
  }
}
