{
  "name": "{{COMPANY_NAME}} - Welder Smart Email Automation",
  "nodes": [
    {
      "parameters": {
        "functionCode": "// Welding Business Intelligence Config Cache Manager\nconst clientId = $env.CLIENT_ID;\nconst configData = $input.first().json;\nconst cacheKey = `config:${clientId}:${configData.version}`;\n\nconst enhancedConfig = {\n  ...configData,\n  weldingIntelligence: {\n    hasEmergencyService: configData.client.phones?.length > 1,\n    serviceTypes: configData.services || ['structural_welding', 'pipe_welding', 'custom_fabrication', 'repair_welding', 'mobile_welding'],\n    workingHours: configData.client.hours || {},\n    priceRanges: configData.pricing || {},\n    serviceArea: configData.client.service_area || 'Local area',\n    managerNames: (configData.people.managers || []).map(m => m.name),\n    supplierDomains: (configData.suppliers || []).flatMap(s => s.domains || []),\n    specializations: ['structural', 'pipe_welding', 'aluminum', 'stainless_steel', 'mobile_service'],\n    emergencyKeywords: ['structural failure', 'emergency repair', 'safety critical', 'urgent'],\n    weldingTypes: {\n      structural: ['building_frames', 'bridge_work', 'industrial_structures', 'load_bearing'],\n      pipe: ['pipeline_welding', 'pressure_vessels', 'boiler_work', 'industrial_piping'],\n      fabrication: ['custom_metalwork', 'architectural_features', 'machinery_parts', 'artistic_work'],\n      repair: ['equipment_repair', 'structural_repairs', 'mobile_welding', 'emergency_fixes']\n    },\n    certifications: {\n      aws: ['D1.1_structural', 'D1.5_bridge', 'D10.9_qualification'],\n      asme: ['section_ix', 'pressure_vessels', 'boiler_code'],\n      api: ['1104_pipeline', '650_tanks', '653_repair']\n    },\n    safetyProtocols: ['confined_space', 'hot_work_permits', 'fume_extraction', 'fire_prevention'],\n    materials: ['carbon_steel', 'stainless_steel', 'aluminum', 'exotic_alloys']\n  }\n};\n\n$setStaticData(cacheKey, enhancedConfig);\nreturn [{ json: { ...enhancedConfig, cached: false, cacheKey: cacheKey } }];"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,
      "position": [-5400, 3200],
      "id": "welding-config-cache",
      "name": "Welding Config Cache"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Subject: {{ $('Gmail Trigger').item.json.subject }}\\nFrom: {{ $('Gmail Trigger').item.json.from }}\\nEmail Body: {{ $('Gmail Trigger').item.json.body }}",
        "options": {
          "systemMessage": "=You are an expert welding contractor email classifier for {{ $json.client.name || 'a welding service company' }}.\\n\\nüè¢ WELDING BUSINESS CONTEXT:\\n- Company: {{ $json.client.name || 'Welding Service Company' }}\\n- Services: {{ $json.weldingIntelligence.serviceTypes.join(', ') }}\\n- Service Area: {{ $json.weldingIntelligence.serviceArea }}\\n- Specializations: {{ $json.weldingIntelligence.specializations.join(', ') }}\\n\\nüéØ WELDING CLASSIFICATION RULES:\\n\\n**URGENT** (Immediate attention required):\\n- Structural welding failures or safety issues\\n- Emergency equipment repairs\\n- Safety-critical welding needs\\n- Pipeline or pressure vessel emergencies\\n\\n**SALES** (Revenue opportunities):\\n- Custom fabrication projects\\n- Structural welding contracts\\n- Industrial equipment manufacturing\\n- Architectural metalwork\\n- Pipeline welding projects\\n\\n**SUPPORT** (Customer service):\\n- Welding repairs and maintenance\\n- Mobile welding services\\n- Equipment modifications\\n- Certification and inspection services\\n\\n**SUPPLIERS** (Vendor communications):\\n- Welding consumables and materials\\n- Equipment and machinery\\n- Safety equipment suppliers\\n\\nüî• WELDING SPECIALIZATIONS:\\n- **Structural:** Building frames, bridges, industrial structures\\n- **Pipe:** Pipeline, pressure vessels, boiler work\\n- **Fabrication:** Custom metalwork, machinery parts\\n- **Mobile:** On-site welding, emergency repairs\\n\\n‚ö†Ô∏è SAFETY PROTOCOLS (CRITICAL):\\n- Hot work permits required\\n- Confined space safety\\n- Fume extraction and ventilation\\n- Fire prevention measures\\n\\nüèÜ CERTIFICATIONS:\\n- **AWS:** D1.1 Structural, D1.5 Bridge, D10.9 Qualification\\n- **ASME:** Section IX, Pressure Vessels, Boiler Code\\n- **API:** 1104 Pipeline, 650 Tanks, 653 Repair\\n\\nü§ñ CLASSIFICATION OUTPUT:\\n{\\n  \\\"primary_category\\\": \\\"category_name\\\",\\n  \\\"confidence\\\": 0.95,\\n  \\\"reasoning\\\": \\\"detailed explanation\\\",\\n  \\\"urgency_level\\\": \\\"low|medium|high|critical\\\",\\n  \\\"requires_draft\\\": true/false,\\n  \\\"welding_context\\\": {\\n    \\\"is_emergency\\\": true/false,\\n    \\\"welding_type\\\": \\\"structural|pipe|fabrication|repair|mobile\\\",\\n    \\\"material_type\\\": \\\"carbon_steel|stainless_steel|aluminum|exotic_alloys\\\",\\n    \\\"certification_required\\\": true/false\\n  }\\n}"
        }
      },
      "id": "welding-ai-classifier",
      "name": "Welding AI Classifier",
      "type": "@n8n/n8n-nodes-langchain.chatOpenAi",
      "position": [-5100, 3200],
      "typeVersion": 1.3
    }
  ],
  "versionId": "7.0.0",
  "meta": {
    "templateVersion": "7.0.0",
    "industry": "Welding",
    "description": "Welding and fabrication email automation with certification and safety intelligence",
    "businessIntelligence": true
  }
}
