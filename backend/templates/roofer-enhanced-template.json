{
  "name": "{{COMPANY_NAME}} - Roofer Smart Email Automation",
  "nodes": [
    {
      "parameters": {
        "functionCode": "// Roofing Business Intelligence Config Cache Manager\nconst clientId = $env.CLIENT_ID;\nconst configData = $input.first().json;\nconst cacheKey = `config:${clientId}:${configData.version}`;\n\nconst enhancedConfig = {\n  ...configData,\n  roofingIntelligence: {\n    hasEmergencyService: configData.client.phones?.length > 1,\n    serviceTypes: configData.services || ['roof_installation', 'roof_repair', 'roof_replacement', 'gutter_services', 'emergency_tarping'],\n    workingHours: configData.client.hours || {},\n    priceRanges: configData.pricing || {},\n    serviceArea: configData.client.service_area || 'Local area',\n    managerNames: (configData.people.managers || []).map(m => m.name),\n    supplierDomains: (configData.suppliers || []).flatMap(s => s.domains || []),\n    specializations: ['residential', 'commercial', 'industrial', 'emergency_services'],\n    emergencyKeywords: ['roof leak', 'storm damage', 'emergency tarping', 'urgent', 'water coming in'],\n    roofingTypes: {\n      residential: ['asphalt_shingles', 'metal_roofing', 'tile_roofing', 'slate_roofing'],\n      commercial: ['tpo_membrane', 'epdm_rubber', 'modified_bitumen', 'built_up_roofing'],\n      specialty: ['green_roofs', 'solar_integration', 'historic_restoration', 'steep_slope']\n    },\n    seasonalServices: {\n      spring: ['storm_damage_assessment', 'gutter_cleaning', 'roof_inspections'],\n      summer: ['new_installations', 'major_replacements', 'commercial_projects'],\n      fall: ['winterization', 'gutter_guards', 'preventive_maintenance'],\n      winter: ['emergency_repairs', 'ice_dam_removal', 'snow_load_assessment']\n    },\n    weatherConsiderations: {\n      storm_season: ['emergency_tarping', 'rapid_response', 'insurance_claims'],\n      winter: ['ice_dams', 'snow_removal', 'freeze_thaw_damage'],\n      summer: ['heat_considerations', 'optimal_installation_weather']\n    },\n    safetyProtocols: ['fall_protection', 'ladder_safety', 'weather_monitoring', 'osha_compliance']\n  }\n};\n\n$setStaticData(cacheKey, enhancedConfig);\nreturn [{ json: { ...enhancedConfig, cached: false, cacheKey: cacheKey } }];"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,\n      "position": [-5400, 3200],\n      "id": "roofing-config-cache",\n      "name": "Roofing Config Cache"\n    },\n    {\n      "parameters": {\n        "promptType": "define",\n        "text": "=Subject: {{ $('Gmail Trigger').item.json.subject }}\\nFrom: {{ $('Gmail Trigger').item.json.from }}\\nEmail Body: {{ $('Gmail Trigger').item.json.body }}",\n        "options": {\n          "systemMessage": "=You are an expert roofing contractor email classifier for {{ $json.client.name || 'a roofing service company' }}.\\n\\nüè¢ ROOFING BUSINESS CONTEXT:\\n- Company: {{ $json.client.name || 'Roofing Service Company' }}\\n- Services: {{ $json.roofingIntelligence.serviceTypes.join(', ') }}\\n- Service Area: {{ $json.roofingIntelligence.serviceArea }}\\n- Emergency Service: {{ $json.roofingIntelligence.hasEmergencyService ? 'Available 24/7' : 'Business hours only' }}\\n\\nüéØ ROOFING CLASSIFICATION RULES:\\n\\n**URGENT** (Immediate attention required):\\n- Active roof leaks or water intrusion\\n- Storm damage with exposed roof areas\\n- Emergency tarping needs\\n- Safety hazards from damaged roofing\\n- Ice dam emergencies\\n\\n**SALES** (Revenue opportunities):\\n- New roof installations\\n- Complete roof replacements\\n- Commercial roofing projects\\n- Gutter system installations\\n- Solar roof integration\\n\\n**SUPPORT** (Customer service):\\n- Roof repairs and maintenance\\n- Gutter cleaning and repairs\\n- Roof inspections\\n- Insurance claim assistance\\n- Preventive maintenance\\n\\n**SUPPLIERS** (Vendor communications):\\n- Roofing material deliveries\\n- Shingle and membrane suppliers\\n- Equipment and tool suppliers\\n\\nüè† ROOFING SPECIALIZATIONS:\\n- **Residential:** Asphalt shingles, metal, tile, slate\\n- **Commercial:** TPO, EPDM, modified bitumen, built-up\\n- **Specialty:** Green roofs, solar integration, historic restoration\\n\\nüå¶Ô∏è WEATHER CONSIDERATIONS:\\n- **Storm Season:** Emergency response, insurance claims\\n- **Winter:** Ice dams, snow removal, freeze-thaw damage\\n- **Summer:** Optimal installation conditions\\n\\n‚ö†Ô∏è SAFETY PROTOCOLS (CRITICAL):\\n- Fall protection required at all times\\n- Weather monitoring for safe working conditions\\n- OSHA compliance mandatory\\n\\nü§ñ CLASSIFICATION OUTPUT:\\n{\\n  \\\"primary_category\\\": \\\"category_name\\\",\\n  \\\"confidence\\\": 0.95,\\n  \\\"reasoning\\\": \\\"detailed explanation\\\",\\n  \\\"urgency_level\\\": \\\"low|medium|high|critical\\\",\\n  \\\"requires_draft\\\": true/false,\\n  \\\"roofing_context\\\": {\\n    \\\"is_emergency\\\": true/false,\\n    \\\"roof_type\\\": \\\"residential|commercial|specialty\\\",\\n    \\\"service_type\\\": \\\"installation|repair|replacement|maintenance|emergency\\\",\\n    \\\"weather_related\\\": true/false\\n  }\\n}"\n        }\n      },\n      "id": "roofing-ai-classifier",\n      "name": "Roofing AI Classifier",\n      "type": "@n8n/n8n-nodes-langchain.chatOpenAi",\n      "position": [-5100, 3200],\n      "typeVersion": 1.3\n    }\n  ],\n  "versionId": "8.0.0",\n  "meta": {\n    "templateVersion": "8.0.0",\n    "industry": "Roofing",\n    "description": "Roofing contractor email automation with weather and emergency intelligence",\n    "businessIntelligence": true\n  }\n}
