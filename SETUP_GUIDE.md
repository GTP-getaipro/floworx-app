# Floworx Setup Guide

## Quick Start

1. **Run the setup script:**
   ```bash
   npm run setup
   ```

2. **Install all dependencies:**
   ```bash
   npm run install-all
   ```

3. **Configure your environment** (see detailed steps below)

4. **Start the application:**
   ```bash
   npm run dev
   ```

## Detailed Setup Instructions

### 1. Database Setup

#### Install PostgreSQL
- Download and install PostgreSQL from https://www.postgresql.org/download/
- Create a database user and database

#### Create Database
```sql
-- Connect to PostgreSQL as superuser
CREATE USER floworx_user WITH PASSWORD 'your_secure_password';
CREATE DATABASE floworx_db OWNER floworx_user;
GRANT ALL PRIVILEGES ON DATABASE floworx_db TO floworx_user;
```

#### Run Database Schema
```bash
# Make sure PostgreSQL is running
psql -U floworx_user -d floworx_db -f backend/database/schema.sql
```

### 2. Environment Configuration

#### Backend Environment Variables
Edit `backend/.env` (created by setup script):

```env
# Database - Update these with your actual credentials
DB_HOST=localhost
DB_PORT=5432
DB_NAME=floworx_db
DB_USER=floworx_user
DB_PASSWORD=your_secure_password

# Security keys (already generated by setup script)
JWT_SECRET=<generated>
ENCRYPTION_KEY=<generated>

# Google OAuth - Get these from Google Cloud Console
GOOGLE_CLIENT_ID=your_google_client_id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_google_client_secret
GOOGLE_REDIRECT_URI=http://localhost:5000/api/oauth/google/callback

# n8n Integration (optional)
N8N_WEBHOOK_URL=https://your-n8n-instance.com/webhook/your-webhook-id

# Server settings
PORT=5000
NODE_ENV=development
FRONTEND_URL=http://localhost:3000
```

### 3. Google OAuth Setup

#### Step 1: Create Google Cloud Project
1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing one
3. Enable the following APIs:
   - Google+ API
   - Gmail API
   - Google Calendar API

#### Step 2: Create OAuth 2.0 Credentials
1. Go to "Credentials" in the left sidebar
2. Click "Create Credentials" → "OAuth 2.0 Client IDs"
3. Choose "Web application"
4. Add authorized redirect URIs:
   - `http://localhost:5000/api/oauth/google/callback` (development)
   - `https://your-domain.com/api/oauth/google/callback` (production)
5. Copy the Client ID and Client Secret to your `.env` file

### 4. n8n Integration (Optional)

#### If you have n8n running:
1. Create a new workflow in n8n
2. Add a "Webhook" trigger node
3. Copy the webhook URL
4. Add it to your `N8N_WEBHOOK_URL` environment variable

#### If you don't have n8n:
- Leave `N8N_WEBHOOK_URL` empty
- The scheduler will log warnings but continue running
- You can add n8n integration later

### 5. Security Checklist

- ✅ Strong database password
- ✅ Secure JWT secret (generated automatically)
- ✅ Encryption key for OAuth tokens (generated automatically)
- ✅ HTTPS in production (configure reverse proxy)
- ✅ Environment variables not committed to git
- ✅ Regular security updates

### 6. Production Deployment

#### Environment Variables for Production:
```env
NODE_ENV=production
DB_HOST=your_production_db_host
FRONTEND_URL=https://your-domain.com
GOOGLE_REDIRECT_URI=https://your-domain.com/api/oauth/google/callback
```

#### Security Considerations:
- Use HTTPS everywhere
- Set up proper firewall rules
- Use environment-specific database credentials
- Enable database SSL connections
- Set up monitoring and logging
- Regular security audits

## Troubleshooting

### Common Issues:

1. **Database connection failed:**
   - Check PostgreSQL is running
   - Verify database credentials in `.env`
   - Ensure database and user exist

2. **Google OAuth not working:**
   - Verify Client ID and Secret in `.env`
   - Check redirect URI matches exactly
   - Ensure APIs are enabled in Google Cloud Console

3. **Frontend can't connect to backend:**
   - Check backend is running on port 5000
   - Verify CORS configuration
   - Check frontend proxy setting

4. **Scheduler not triggering:**
   - Check n8n webhook URL is correct
   - Verify users have active Google connections
   - Check server logs for errors

## Support

For issues or questions:
1. Check the console logs for error messages
2. Verify all environment variables are set correctly
3. Ensure all dependencies are installed
4. Check that PostgreSQL is running and accessible
